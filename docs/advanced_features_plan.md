# 重心ケアアプリ開発：先進機能統合プラン（v2025.11.01版）

## 🚀 目的

日本国内外の医療的ケア児者（医ケア児）支援の最新動向を踏まえ、重症心身障がい児者に特化したケアアプリにおいて世界最高峰を目指す先進機能を計画的に段階実装するためのリファレンス文書。

## ✅ 優先度付き導入ロードマップ

### ✅ STEP 1：即効性の高い業務効率化支援

**目標**: 日常業務の記録・報告作業を大幅に効率化し、スタッフの負担を軽減する

#### 実装項目

1. **音声入力による日誌記録 → 自動レポート生成機能（GPT）**
   - 状態: 🚧 一部実装済み
   - 既存実装: `components/VoiceRecorder.tsx`（Web Speech API）
   - 次のアクション:
     - [ ] OpenAI Whisper API連携（より高精度な文字起こし）
     - [ ] 音声から構造化データへの自動変換（GPT-4によるパース）
     - [ ] 記録カテゴリ自動推定（バイタル/発作/ケア/観察）

2. **AI要約機能（LangChain + GPT）をPDF月次レポートと連携**
   - 状態: ✅ 実装済み
   - 実装済み:
     - `services/langchain/agent.ts`: GPTベース要約関数
     - `config/langchain.ts`: モデル設定の一元管理
     - `tests/unit/langchain-agent.spec.ts`: ユニットテスト（3件）
   - 次のアクション:
     - [ ] 月次レポート生成フローへの統合（`reports/generateMonthlyReport.ts`）
     - [ ] PDFコンポーネントへのAI要約表示（`components/pdf/monthly-report-doc.tsx`）
     - [ ] キャッシング機構（同一月の再要約を避ける）

3. **服薬リマインダー・与薬記録・相互作用警告（最低限実装）**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] 服薬スケジュールデータ構造（Dexie DB拡張）
     - [ ] リマインダー通知機能（Service Worker + Push API）
     - [ ] 与薬記録フォーム（投薬時刻/薬剤名/用量）
     - [ ] 相互作用チェック（薬剤マスタとの照合）

---

### ✅ STEP 2：家族と多職種連携の強化

**目標**: 家族・医療者・福祉スタッフ間の情報共有を円滑化し、チームケアの質を向上させる

#### 実装項目

1. **関係者限定チャット・メモ共有機能（HIPAA準拠）**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] リアルタイムメッセージング（WebSocket or Firebase Realtime DB）
     - [ ] ロールベースアクセス制御（家族/医師/看護師/スタッフ）
     - [ ] エンドツーエンド暗号化（Web Crypto API）
     - [ ] 監査ログ（誰がいつ何を閲覧/編集したか）

2. **共有カレンダー／ToDo／ファイル（診療サマリー等）保管**
   - 状態: 🚧 一部実装済み（家族ポータル仮ページ）
   - 既存実装: `app/family/page.tsx`（共有コード生成・QR表示）
   - 次のアクション:
     - [ ] ToDoリストデータ構造（優先度/担当者/期限/完了状態）
     - [ ] カレンダーUI（予定入力/通知設定）
     - [ ] ファイルアップロード・プレビュー機能（PDF/画像）
     - [ ] 共有範囲設定（全員/特定ユーザーのみ）

3. **緊急通知機能（SpO₂・心拍アラート、SOS送信）**
   - 状態: 🚧 一部実装済み（AI監視基盤）
   - 既存実装:
     - `services/ai-monitoring/index.ts`: 閾値ベース異常検知
     - `app/settings/thresholds/page.tsx`: 閾値設定UI
   - 次のアクション:
     - [ ] リアルタイム通知（Service Worker + Push通知）
     - [ ] SMS/メール送信連携（Twilio/SendGrid）
     - [ ] 緊急連絡先管理UI
     - [ ] SOSボタン配置（ワンタップで全関係者へ通知）

---

### ✅ STEP 3：バイタル・排泄・生活支援データ連携

**目標**: IoTセンサー・ウェアラブルデバイスと連携し、客観的データに基づくケアを実現する

#### 実装項目

1. **DFree/ウェアラブル連携による排泄予測 → アプリ通知**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] Bluetooth Low Energy (BLE) 接続ライブラリ
     - [ ] DFree SDK統合（排泄予測API）
     - [ ] 予測通知UI（「20分以内に排泄の可能性」）
     - [ ] 排泄記録との自動紐付け

2. **SpO₂/心拍のBluetooth連携、状態変化を記録・警告**
   - 状態: 🚧 一部実装済み（手動入力のみ）
   - 既存実装: `components/forms/vitals-form.tsx`（手動バイタル入力）
   - 次のアクション:
     - [ ] BLE対応パルスオキシメータ連携
     - [ ] 自動記録（バックグラウンドで定期取得）
     - [ ] 異常値検知時の自動警告（AI監視と統合）

3. **体位変換リマインダーとセンサー統合（褥瘡予防）**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] 体位変換スケジュール管理
     - [ ] 圧力センサー連携（ベッド埋込型/マット型）
     - [ ] リマインダー通知（2時間ごと等）
     - [ ] 体位変換記録フォーム（左側臥位/右側臥位/仰臥位）

---

### ✅ STEP 4：本人向け機能（インクルーシブ設計）

**目標**: 利用者本人の自己決定・表現・創作活動を支援し、QOLを向上させる

#### 実装項目

1. **非言語コミュニケーション支援（意思伝達装置連携）**
   - 状態: ⏳ 未着手
   - 参考製品: 「いしん伝心」（視線入力/ジェスチャー認識）
   - 必要な実装:
     - [ ] Mediapipe統合（視線追跡/ジェスチャー検出）
     - [ ] 意思表示ボタン配置（「はい/いいえ/痛い/嬉しい」等）
     - [ ] 記録との連携（感情・意思表示を日誌に自動追加）

2. **感覚刺激（Light Box等）や創作支援（ポティア連携）**
   - 状態: ⏳ 未着手
   - 参考製品: 「Poteer」（身体動作→アート/音楽生成）
   - 必要な実装:
     - [ ] 視覚刺激UI（色変化/パターン表示）
     - [ ] 音声リズム検出→音楽生成
     - [ ] 創作物ギャラリー（保存/共有機能）

3. **音声読み上げ、視認性高いUI（高コントラスト対応）**
   - 状態: 🚧 一部実装済み（ARIA属性）
   - 既存実装: 各フォームコンポーネントでARIA対応済み
   - 次のアクション:
     - [ ] Web Speech API（読み上げ）全ページ実装
     - [ ] ハイコントラストテーマ（白黒反転/大きな文字）
     - [ ] キーボードナビゲーション完全対応

---

### ✅ STEP 5：医療者・行政との連携

**目標**: 医療機関・行政との連携を強化し、シームレスな情報共有とエビデンスに基づくケアを実現する

#### 実装項目

1. **PHR（ケア記録 ⇔ 主治医）共有機能（FHIR準拠も視野）**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] FHIR形式へのデータ変換（Observation/Condition/MedicationStatement）
     - [ ] OAuth2認証（医療機関システムとの連携）
     - [ ] 共有同意管理UI（本人/家族の明示的同意）

2. **GPTチャットボットによるQ&A（親・スタッフ向け）**
   - 状態: 🚧 基盤実装済み（LangChain Agent）
   - 既存実装: `services/langchain/agent.ts`
   - 次のアクション:
     - [ ] FAQ機能の拡張（医ケア児特有の質問対応）
     - [ ] チャットUIコンポーネント作成
     - [ ] RAG（検索拡張生成）による専門知識ベース参照

3. **感情分析・ストレス検知 → 自動リスクアラート提案**
   - 状態: ⏳ 未着手
   - 必要な実装:
     - [ ] テキスト感情分析（日誌の記述内容から）
     - [ ] バイタル変動パターン解析（ストレス指標）
     - [ ] 自動アラート生成（「最近3日間のストレスレベル上昇」）
     - [ ] 対処法提案（GPTによる推奨事項生成）

---

## 🔁 LangChain Agent/AI Agent が実行時に参照すべき事項

### 基本原則

1. **このドキュメントの構成・優先順位を参照し、適切な段階でのみ先進機能を設計・実装・評価すること。**
2. LangChain Agent や AI Assistant はこのファイルを事前に読み込み、対象タスクのレベル・依存関係・目的を確認すること。
3. VSコード内のCoPilotへこのファイルへのリンク、またはmd内見出しの明示を含めた実行指示を送ること。

### 実装の進め方

#### 新機能追加時のチェックリスト

- [ ] 該当するSTEPの目標と整合しているか
- [ ] 既存実装との依存関係を確認したか
- [ ] データ構造の拡張が必要な場合、`lib/db.ts`または`schemas/unified.ts`を更新したか
- [ ] アクセシビリティ（ARIA属性、キーボード操作）を考慮したか
- [ ] ユニットテストを追加したか（`tests/unit/`配下）
- [ ] ビルド・テストが通過することを確認したか（`pnpm -s build && pnpm -s vitest run`）

#### CoPilot用プロンプト例

**例1: STEP 2のToDo機能実装**

```
以下の先進機能統合プラン（docs/advanced_features_plan.md）に基づき、STEP 2の連携機能強化を対象とする実装を行ってください。まずは「ToDoリスト機能」のデータ構造と保存先を定義し、仮UIを作成し、保存・一覧・完了トグル機能を段階実装してください。

実装要件:
- Dexie DBにtodosテーブルを追加
- schemas/todo.ts でTodoEntryスキーマ定義
- app/todos/page.tsx で一覧・追加・完了UI作成
- 優先度（高/中/低）、担当者、期限、完了状態を管理
- ARIA属性を適切に設定
```

**例2: STEP 3のBLE連携**

```
docs/advanced_features_plan.md の STEP 3「SpO₂/心拍のBluetooth連携」を実装してください。

実装要件:
- services/ble/pulse-oximeter.ts を作成
- Web Bluetooth API を使用してBLE接続
- 取得したSpO₂/心拍データを自動的にDexie DBへ保存
- components/forms/vitals-form.tsx に「デバイス接続」ボタンを追加
- 接続状態の表示とエラーハンドリング
```

---

## 📊 進捗追跡

### 実装済み機能（✅）

- [x] 統一データモデル（`schemas/unified.ts`）
- [x] AIモニタリング基盤（`services/ai-monitoring/`）
- [x] LangChain Agentの基礎実装（`services/langchain/agent.ts`）
- [x] 月次レポート生成（`reports/generateMonthlyReport.ts`）
- [x] 家族ポータル仮ページ（共有コード生成）
- [x] 音声記録コンポーネント（Web Speech API）

### 次期実装候補（優先度順）

1. **STEP 1-2**: AI要約の月次PDF統合（即効性大）
2. **STEP 2-2**: ToDoリスト機能（多職種連携の基盤）
3. **STEP 1-3**: 服薬リマインダー（業務効率化）
4. **STEP 2-3**: 緊急通知機能（既存AI監視との統合）
5. **STEP 3-2**: BLE連携（バイタル自動取得）

---

## 📝 変更履歴

- **2025-11-01**: 初版作成。既存実装状況を反映し、5段階ロードマップを定義。

---

## 📚 参考資料

- [FHIR日本実装仕様](https://jpfhir.jp/)
- [Web Bluetooth API仕様](https://webbluetoothcg.github.io/web-bluetooth/)
- [WCAG 2.1（アクセシビリティガイドライン）](https://www.w3.org/WAI/WCAG21/quickref/)
- [DFree公式サイト](https://dfree.biz/)
- [Poteer公式サイト](https://www.poteer.net/)

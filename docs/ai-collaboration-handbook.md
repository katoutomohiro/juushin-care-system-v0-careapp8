# AI協調開発ハンドブック（必読）

> **重要**: ChatGPT (gpt-5-codex)、GitHub Copilot、v0、そしてオーナーは、作業を開始する前に必ず本ドキュメントを読み、チェックリストを確認してください。各サイクル開始時に「ハンドブックを参照済み」であることを明示してください。

## 1. 目的と利用方法

- 本ハンドブックは、重心ケアアプリ (リポジトリ: `katoutomohiro/juushin-care-system-v0-careapp8`) に関わるすべてのAIエージェントとオーナーの共通認識を一本化するためのものです。
- ここに記載された手順・役割・優先タスクを最新のソースとし、旧来の計画ドキュメントは参照しません。更新が必要になった場合は、このファイルを修正し、その旨を全員に共有してください。
- 各エージェントは作業ログに「AI協調開発ハンドブック確認済み」の旨を明記し、逸脱が必要な場合はオーナーとChatGPTで合意を取ってから実行します。

## 2. プロジェクト概要

| 項目 | 内容 |
| --- | --- |
| アプリ名 | 重心ケア支援アプリ (暫定) |
| 目的 | 医療・介護現場での重症心身障がい児者ケア記録の効率化 |
| 主な技術スタック | Next.js 15.2.4 (App Router)、React 19、TypeScript 5、Tailwind CSS 3.4、shadcn/ui |
| 補助ライブラリ | React Hook Form、Zod、Radix UI、@react-pdf/renderer など |
| データ層 | Supabase（認証・データベース）を利用可能。フロントは暫定的にローカルステートを併用しつつ、必要に応じて Supabase API と連携する |
| テスト/ツール | Vitest、Playwright、Testing Library、Storybook (導入済みだが整備が必要) |
| デプロイ想定 | Vercel |

## 3. 現状確認プロセス

作業開始時は以下を実行し、実際の状態を確認してから計画を立ててください。

```bash
# オープンなPRとIssueの確認
gh pr list --state open --json number,title,headRefName,mergeStateStatus,statusCheckRollup
gh issue list --state open --json number,title,labels

# 主要ブランチの最新化
git fetch origin
git checkout main
git pull origin main
```

- PR/Issue の件数や内容が本ハンドブックの記載と異なる場合は、差分を記録しオーナーへ報告してください。
- `gh` コマンドを実行できないエージェント（例: v0）は、GitHub Web UI のダッシュボードやオーナー/ChatGPT が共有するサマリーで同等の確認を行ってください。
- 状況を確認したら、実行するタスクを「優先タスクリスト」に照らし合わせて調整します。

## 4. 優先タスクリスト (要確認)

以下は現在共有されている主要タスクです。実行前に必ず最新状況を確認し、完了済みであればチェックを更新してください。

1. **ジャーナルエントリー機能の安定化** – バイタル・服薬・記録フォームを Supabase と同期し、保存・閲覧・編集の一連の UX を完成させる。
2. **オブジェクトキー構文エラーの再発防止** – 2025 年 2 月に発生した `Record<string, T>` の動的キー扱いに関するバグ修正を踏まえ、フォームバリデーションと自動テストを追加して品質を確保する。
3. **UI/アクセシビリティ改善** – 重心ケア記録画面のレイアウト、レスポンシブ対応、スクリーンリーダーサポートを強化する。
4. **CI/CD と品質ゲート整備** – `npm run lint`、`npm run test`、`npm run build` を GitHub Actions で自動実行し、失敗時の通知フローを整える。
5. **ドキュメントと手順の更新** – ハンドブック、検証手順、環境構築ガイドを現状に合わせて更新し、オンボーディングを容易にする。
6. **Supabase セキュリティとシードデータ** – RLS ポリシーの再確認と、開発用シードデータ投入スクリプトの整備を行う。

## 5. 開発サイクル

1. **オーナー → ChatGPT へ実行指示**
   - 目的・要件・優先度・制約条件を具体的に伝える。
2. **ChatGPT が作業計画を立案**
   - 必要なサブタスクを整理し、Copilot や v0 に委譲する範囲を決定。
3. **実装フェーズ (ChatGPT 主導、Copilot/v0 補助)**
   - v0: UI モックだけでなく、Next.js ページや API ルート、Supabase 連携を含むフルスタック実装のたたき台を用意可能。必要に応じて server actions や型定義も生成する。
   - Copilot: コード補完や小規模実装を支援（ChatGPT がレビュー）。
4. **オーナーによる検証**
   - ChatGPT が提示する検証手順に基づき動作確認。結果をフィードバック。
5. **ファイル保存とコミット (ChatGPT)**
   - 確認済みの変更のみコミット。リポジトリの最新状態を GitHub に保持。
6. **サイクル継続**
   - フィードバックを踏まえて追加の修正/機能開発に移行。

## 6. 役割と責任

### オーナー
- 要求・優先順位・完了判定を明確化し、未確定事項の決定を行う。
- ChatGPT からの質問には具体的に回答し、テスト結果をフィードバックする。

### ChatGPT (gpt-5-codex)
- プロジェクトの技術責任者。計画策定、実装統括、レビュー、ドキュメント更新を担当。
- Copilot/v0 の成果物を検証し、必要に応じて修正する。
- コミット・PR 作成・リリースノート作成を管理。

### GitHub Copilot
- VS Code などのエディタ内でのコード補完を担当。指示された関数/テストの草案作成。
- 複雑な設計判断は行わず、ChatGPT の指示を厳守。

### v0
- Next.js ページ、サーバーアクション、Supabase 連携を含むフルスタックのプロトタイプ作成が可能。
- shadcn/ui および Tailwind デザインシステムと整合する提案を返し、UI/UX 改善の選択肢を提示する。

## 7. エージェント別チェックリスト

### オーナー
- [ ] 本ハンドブックを再確認した。
- [ ] 依頼する機能のゴールと制約を言語化した。
- [ ] 確認手順と評価基準を準備した。

### ChatGPT
- [ ] 本ハンドブックを再確認した。
- [ ] 現状確認プロセス (セクション 3) を実行した。
- [ ] 影響範囲とテスト計画を整理した。
- [ ] コミット/PR 戦略を決定した。

### GitHub Copilot
- [ ] 本ハンドブックの役割とタスク範囲を確認した。
- [ ] 編集対象ファイル全体を読み込んだ。
- [ ] 型/エラーハンドリング方針を把握した。

### v0
- [ ] 本ハンドブックの役割とタスク範囲を確認した。
- [ ] 既存コンポーネントとデザインシステムを確認した。
- [ ] オーナーまたは ChatGPT から共有された画面遷移・レスポンシブ・データ連携要件を確認した。

## 8. 実装時の共通ルール

- **透明性:** 進行中のブランチ、未解決課題、意思決定はこのハンドブックまたは関連ドキュメントに反映する。
- **整合性:** 変更点は TypeScript の型整合と ESLint ルールを満たすようにする。
- **テスト:** `npm run lint` / `npm run test` / `npm run build` など、該当するチェックを実施し結果を記録する。
- **ドキュメント更新:** 仕様変更やワークフロー更新時は必ず本ハンドブックを最新版にする。
- **セキュリティ/プライバシー:** 医療データを扱う前提でログや公開情報に個人情報を含めない。

### 8.1 エージェント能力マトリクス

| エージェント | 実行可能な主なアクション | 実行が難しい/不可なアクション |
| --- | --- | --- |
| オーナー | 要件定義、ビジネス判断、手動検証、実デプロイ操作 | 自動テストの実装、長時間のコーディング |
| ChatGPT | TypeScript/React/Next.js/Supabase 実装、設計レビュー、テストコード作成、ドキュメント整備、CLI 実行 | GUI 操作、フィジカルデバイスでの手動確認 (オーナーの支援が必要) |
| GitHub Copilot | エディタ内での補完、既存コードへのインライン提案 | 複数ファイルに跨る大規模リファクタ、仕様判断 |
| v0 | 画面デザイン、Next.js ページ・ルート生成、Supabase 連携を含むフルスタック実装の骨組み | CLI 実行、ローカルテスト、リポジトリの状態管理 |

### 8.2 最近の教訓とベストプラクティス

- **動的オブジェクトキーの扱い:** 2025-02 にフォーム入力で `obj[someKey]` を更新する際、`someKey` の型が限定されておらずランタイムエラーとなった。Zod スキーマで許容キーを定義し、型安全なアクセサ関数 (`updateField<T extends keyof Schema>`) を通じて更新する。単体テストを追加し回帰を防止する。
- **Supabase API の利用:** サーバーアクションや Edge Functions から Supabase クライアントを呼び出す場合、`createRouteHandlerClient` など Next.js 推奨の初期化ヘルパーを用いる。RLS を前提としたポリシー確認と、環境変数の取り扱いに注意する。
- **GitHub Actions の権限:** 機密性の高い環境変数は OpenID Connect + 短期トークンで渡し、workflow 内では `secrets` への直接書き込みを避ける。

## 9. コミュニケーションテンプレート

### オーナー → ChatGPT
```
目的:
背景:
要件:
制約:
完了の定義:
確認方法:
```

### ChatGPT → オーナー (成果報告)
```
対応内容:
変更ファイル:
テスト結果:
追加の確認事項:
次の提案ステップ:
```

### ChatGPT → GitHub Copilot / v0 (サブタスク指示)
```
目的:
対象ファイル:
期待する成果物:
検証ポイント:
タイムライン/優先度:
```

### v0 → オーナー / ChatGPT (成果報告・質問)
```
対応中のタスク:
進捗状況:
確認した要件:
不明点・追加で必要な情報:
次のアクション案:
```

## 10. 更新履歴

- **2025-10-12**: v0 チェックリストとコミュニケーションテンプレートを最新の運用に合わせて更新（ChatGPT）。
- **2025-02-15**: 優先タスク・v0 の役割・Supabase 利用方針・最近の教訓を反映。エージェント能力マトリクスを追加（ChatGPT）。
- **2025-02-14**: 既存の計画ドキュメントを統合し、本ハンドブックとして再編成（ChatGPT）。

---

このハンドブックは常に最新の情報源であり、作業前に必ず確認してください。必要に応じてオーナーと相談しながら更新を継続しましょう。

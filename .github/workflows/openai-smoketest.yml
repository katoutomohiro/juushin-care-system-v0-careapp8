name: openai-smoketest
on:
  workflow_dispatch:
  push:
    branches: ['**']
  pull_request:
    branches: ['**']
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Skip for dependabot (no secrets)
        if: github.actor == 'dependabot[bot]'
        run: |
          echo "Dependabot PR: secrets unavailable, skipping OpenAI smoketest."
          exit 0
      - uses: actions/checkout@v5
      - uses: actions/setup-python@v6
        with: { python-version: "3.11" }
      - run: pip install openai
      - name: Call OpenAI /models
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python - <<'PY'
          import os, sys
          from openai import OpenAI
          key = os.environ.get("OPENAI_API_KEY")
          try:
            client = OpenAI(api_key=key)
            client.models.list()
            print("✅ OpenAI key works.")
          except Exception as e:
            print("❌ OpenAI key check failed:", e)
            sys.exit(1)
          PY
